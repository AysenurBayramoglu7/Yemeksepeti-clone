@model List<YemekSepeti.Entities.Restoran>

@{
    ViewData["Title"] = "Favorilerim";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">
    <h2 class="mb-4">Favori RestoranlarÄ±m</h2>

    @if (Model != null && Model.Count > 0)
    {
        <div class="row">
        @foreach (var r in Model)
        {
            <div class="col-md-4 mb-4">
                <a asp-controller="Restoran" asp-action="Detay" asp-route-id="@r.RestoranID" class="text-decoration-none text-dark">
                    <div class="card shadow-sm border-0 h-100">
                         <div class="position-relative">
                             <img src="@r.RestoranResimUrl" class="card-img-top" style="height: 200px; object-fit: cover;" alt="@r.RestoranAd">
                         </div>
                        <div class="card-body">
                            <h5 class="card-title">@r.RestoranAd</h5>
                            <p class="text-muted small">
                                â± @r.OrtalamaSure dk â€¢ ğŸ›’ Min: @r.MinSiparisTutar TL
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-success">@r.Puan / 5</span>
                                <button class="btn btn-outline-danger btn-sm" onclick="favoridenCikar(@r.RestoranID, event, this)">
                                    <i class="bi bi-trash"></i> KaldÄ±r
                                </button>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center" role="alert">
            HenÃ¼z favori restoranÄ±nÄ±z bulunmamaktadÄ±r. <a href="/" class="alert-link">RestoranlarÄ± keÅŸfetmek iÃ§in tÄ±klayÄ±n.</a>
        </div>
    }
</div>

<script>
    function favoridenCikar(restoranId, event, btnElement) {
        event.preventDefault(); // Linke gitmeyi engelle
        event.stopPropagation();

        if(!confirm('Bu restoranÄ± favorilerden Ã§Ä±karmak istediÄŸinize emin misiniz?')) return;

        fetch('/Favori/Sil?restoranId=' + restoranId, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // KartÄ± sayfadan kaldÄ±r
                const cardCol = btnElement.closest('.col-md-4');
                cardCol.remove();
                
                // EÄŸer hiÃ§ kart kalmadÄ±ysa sayfayÄ± yenile (boÅŸ mesajÄ± Ã§Ä±ksÄ±n diye)
                if(document.querySelectorAll('.col-md-4').length === 0){
                    location.reload();
                }
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Hata:', error));
    }
</script>
